<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    {% comment %} <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css"> {% endcomment %}
</head>

<body>
<style>
.w3-container {
  font-size: 24px;
}

.center {
  position: absolute;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
}
</style>
{% load convert_USD %}
<div class="center">
  <h3 class="donate">
    <div class="w3-card-4">

  

    <div class="w3-container">
    <p>Amount to Pay : USD {{amount|usd_convert:currency}}</p>

    <!-- PAYPAL BUTTONS HERE -->
    <div id="paypal-button-container"></div>

    <!-- Include the PayPal JavaScript SDK -->
    <script src="https://www.paypal.com/sdk/js?client-id=AZIm1q4nNWX-CpoJxUU1l1b-Z906A1q5ruuPQMRgBM18GHJndFZ22Z1hcFJGfaNo6FJY8tSHP-7JbOkd&currency=USD"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <script>
        // Render the PayPal button into #paypal-button-container
        paypal.Buttons({
            style: {
                color:  'blue',
                shape:  'pill',
                label:  'pay',
                height: 40,
                layout: 'horizontal'
            },

            // Set up the transaction
            createOrder: function(data, actions) {
                return actions.order.create({
                    purchase_units: [{
                        amount: {
                            value: '{{amount|usd_convert:currency}}'
                        }
                    }]
                });
            },

            // Finalize the transaction
            onApprove: function(data, actions) {
                return actions.order.capture().then(function(orderData) {
                    // Successful capture! For demo purposes:
                    console.log('Capture result', orderData, JSON.stringify(orderData, null, 2));
                    var amount=orderData.purchase_units[0].amount.value;
                    var code=orderData.purchase_units[0].amount.currency_code;
                    //alert(amount);
                    //alert(code);
                    //console.log();
                    var transaction = orderData.purchase_units[0].payments.captures[0];
                    alert('Transaction '+ transaction.status + ': ' + transaction.id + '\n\nSee console for all available details');
                    console.log("SENT");
                    var ul="{%url 'Vendor_Checkout' %}?type=paypal&status=DONE&transid="+transaction.id+"&amount={{amount|usd_convert:currency}}";

                    axios.get("{%url 'Vendor_Checkout' %}?type=paypal&status=DONE&service_fee="+amount+"&code="+code+"&transid="+transaction.id+"&amount={{amount}}")
                    .then(function(response){
                        console.log(response);
                        
                        window.location.replace(ul);
                        
                    });
                    console.log("DONE");
                    //$.ajax({url: "{%url 'Vendor_Checkout' %}?type=paypal&status=DONE&service_fee="+amount+"&code="+code+"&transid="+transaction.id+"&amount={{amount}}",type: 'GET' ,success: function(result){
                     //   var ul="{%url 'Vendor_Checkout' %}?type=paypal&status=DONE&transid="+transaction.id+"&amount={{amount|usd_convert:currency}}";
                        //actions.redirect("www.eventinz.com{%url 'Vendor_Checkout_renewal' %}?type=paypal&status=DONE&transid="+transaction.id+"&amount={{amount}}");
                    //    window.location.replace(ul);

                    //  }
                    //});
                    // Replace the above to show a success message within this page, e.g.
                    // const element = document.getElementById('paypal-button-container');
                    // element.innerHTML = '';
                    // element.innerHTML = '<h3>Thank you for your payment!</h3>';
                    // Or go to another URL:  actions.redirect('thank_you.html');
                });
            }


        }).render('#paypal-button-container');
    </script>

    </div>

    

    </div>
  </h3>
</div>

</body>